<html lang="en">
  <head>
    <link href="styles.css" rel="stylesheet" type="text/css">
    <link href="landing.css" rel="stylesheet" type="text/css">
    <link href="pregame.css" rel="stylesheet" type="text/css">
    <link href="test.css" rel="stylesheet" type="text/css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />


    <script src="/socket.io/socket.io.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Amatic+SC:wght@700&family=Architects+Daughter&family=Lato&family=Permanent+Marker&family=Russo+One&family=Playfair+Display&display=swap');

html {

}

body {
    width: 100%;

    /*background: rgb(17,126,187);
    background: linear-gradient(0deg, rgba(17,126,187,1) 0%, rgba(21,228,236,1) 100%);
    */
    background: #ECF7FD;
    
    background-repeat: no-repeat;
    color: black;
}

.wide {
    width: 100%;
}

.full-page-size {
    width: 100%;
}

.action-button {
    transition: 0.3s all;
    padding: 5px 10px;
    width: 100%;
    font-family: "Permanent Marker";
    font-size: 24px;
    border: 1px solid black;
    background: #106593;
    color: white;
    height: 70px;
}

.action-button:hover {
    cursor: pointer;
    background: #0C4C6E;
}

.action-button:disabled {
    background-color: grey !important;
}

.action-button:disabled:hover {
    cursor: initial !important;
}

.room-modal {
    position: fixed;
    z-index: 3;
    font-family: "Permanent Marker";
    background: white;
    top: 50px;
    left: 5%;
    width: 90%;
    height: 400px;
    text-align: center;
}

.room-modal-shadow {
    z-index: 2;
    position: fixed;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    background-color: #0C4C6E;
    opacity: 0.8;
}

.room-modal-content {
    position: relative;
    margin: 0 auto;
    margin-top: 50px;
    color: black;
    text-align: center;
}

.room-modal-title {
    padding: 25px 0;
    text-align: center;
}

.room-modal-label {
    font-size: 18px;
    margin-right: 10px;
    margin-bottom: 0;
}

.room-modal-input {
    height: 35px;
    font-size: 16px;
}

.room-modal-data-box {
    margin-bottom: 25px;
}

.modal-button {
    position: absolute;
    top: 250px;
    left: calc(50% -  75px);
    font-size: 16px;
    width: 150px;
}

    </style>

    <style>
        .title {
    margin-top: 25px;
    text-align: center;
    font-family: "Amatic SC";
    font-size: 120px;
    color: #106593;
    text-transform: uppercase;
    text-shadow: 
    2px 2px 0px black,
    -1px -1px 0px #2fe8ee;
}

.subtitle {
    margin-bottom: 35px;
    padding: 2px 4px;
    text-align: center;
    font-style: oblique;
    font-family: "Amatic SC";
    font-size: 60px;
}

.landing-buttons-panel {
    padding: 10px;
    width: 100%;
    background: white;
    border: 1px solid #106593;
}

.name-input input {
    width: 100%;
    max-width: 100%;
    color: black;
    height: 40px;
    font-size: 24px;
    font-weight: bold;

}

.join-button-container {
    width: 275px;
    padding: 0;
    margin-top: 15px;

}

.room-code-container {
    margin-top: 15px;
    color: black;
    height: 40px;
    font-size: 24px;
    font-weight: bold;
    width: 275px;
}

.room-code-container input {
    text-align: center;
    box-sizing: border-box;
    width: 100%;
    font-family: "Permanent Marker";
}

.dev-log-container {
    overflow: hidden;
    position: relative;
    background-color: #ECF7FD;
    margin-bottom: 25px;
}

.dev-log-container::-webkit-scrollbar {
    display: none;
    width: 0 !important;
}

.dev-log {
    padding: 10px;
    position: relative;
    font-family: "Playfair Display";
    overflow: auto;
    max-height: 1000px;
    scrollbar-width: none;
}

.dev-log-element {
    margin-bottom: 20px;
}

.dev-log-element h2, .dev-log-element h3 {
    font-weight: bold;
}

.dev-log-title {
    margin-top: 50px;
    font-family: "Playfair Display";
    font-weight: bold;
}

.dev-log-element ul {
    list-style-type: none;
}

.dev-log-element li:before {
    content: "- "
}

footer {
    width: 100%;
    background: #106593;
    color: white;
    height: 30px;
    position: absolute;
    bottom: 0;
    left: 0;
}
    </style>

    <style>
        .info-panel {
    background: #2FE8EE;
    width: 100%;
    height: 50px;
    font-size: 110%;
}

.info-panel .container {
    height: 100%;
}

.info-panel-text {
    font-family: "Permanent Marker";
    margin-right: 20px;
}

.leave-button {
    height: 90%;
    margin: 5% 0%;
    width: initial;
    background-color: #ECF7FD;
    color: black;
    font-size: inherit;
}

.leave-button:hover {
    background: #DAEFFB;
}

.teams-container {
    margin-top: 25px;
    margin-bottom: 25px;
    font-family: "Permanent Marker";
}

.team {
    width: 50%;
    min-width: 250px;
    margin-bottom: 25px;
}

.team-name {
    text-align: center;
    font-size: 44px;
    text-decoration: underline;
    margin-right: 25px;
}

.join-team-button {
    font-size: 20px;
    height: initial;
    vertical-align: bottom;
}

.team-member {
    font-size: 28px;
}

.clue-giver::after {
    margin-left: 10px;
    font-family: "Font Awesome 5 Free";
    font-weight: 900;
    content: "\f06e";
}

.start-game-button-container {
    position: absolute;
    bottom: 5vh;
    left: calc(50% - 150px);
    width: 300px;
}
    </style>

    <style>
        .words-panel {
            margin: 10px auto 10px;
            width: 100%;
            text-align: center;
            max-width: 500px;
            border: 1px solid #106593;
        }

        .words-panel-word {
            background: #106593;
            color: white;
            height: 2.75rem;
            font-family: "Permanent Marker";
            font-size: 1.3rem;
        }

        .guessed-word::after {
            margin-left: 10px;
            font-family: "Font Awesome 5 Free";
            font-weight: 900;
            content: "\f00c";
        }

        .hidden-word {
            background: grey;
        }

        hr {
            background: white;
            margin: 0 !important;
        }

        .game-input-panel {
            text-align: center;
            font-family: "Permanent Marker";
            height: 60px;
            width: 100%;
            max-width: 500px;
            margin: 0 auto 10px;
        }

        .submit-guess-input-container, .submit-bid-input-container {
            margin-right: 5px;
            width: 100%;
        }

        .submit-bid-input-container {
            font-family: "Permanent Marker";
            font-size: 20px;
        }

        .submit-guess-input, .submit-bid-input {
            height: 100%;
            width: 100%;
            text-align: center;
            font-size: 36px;
            font-family: "Permanent Marker";
        }

        .player-bid-text {
            width: 200px;
            
        }

        .player-bid-text-number {
        }

        .arrow-down {
            width: 0; 
            height: 0; 
            border-left: 22px solid transparent;
            border-right: 22px solid transparent;
            
            border-top: 25px solid #106593;
        }

        .arrow-up {
            width: 0; 
            height: 0; 
            border-left: 22px solid transparent;
            border-right: 22px solid transparent;
            
            border-bottom: 25px solid #106593;
        }

        .arrow-down:hover {
            cursor: pointer;
            border-top: 25px solid #0C4C6E;
        }

        .arrow-up:hover {
            cursor: pointer;
            border-bottom: 25px solid #0C4C6E;
        }

        .submit-guess-button-container, .submit-bid-button-container {
            min-width: 75px;
            height: 60px;
        }

        .submit-guess-button, .submit-bid-button {
            height: 100%;
            font-size: 16px;
        }

        .game-info-panel {
            font-family: "Permanent Marker";
            width: 100%;
        }

        /* CLOCK CSS from CSStricks */

        /* Sets the containers height and width */
        .base-timer {
            position: relative;
            height: 300px;
            width: 300px;
        }

        /* Removes SVG styling that would hide the time label */
        .base-timer__circle {
            fill: none;
            stroke: none;
        }

        /* The SVG path that displays the timer's progress */
        .base-timer__path-elapsed {
            stroke-width: 7px;
            stroke: grey;
        }

        .base-timer__label {
            position: absolute;
            
            /* Size should match the parent container */
            width: 300px;
            height: 300px;
            
            /* Keep the label aligned to the top */
            top: 0;
            
            /* Create a flexible box that centers content vertically and horizontally */
            display: flex;
            align-items: center;
            justify-content: center;

            /* Sort of an arbitrary number; adjust to your liking */
            font-size: 48px;
        }

        .base-timer__path-remaining {
            /* Just as thick as the original ring */
            stroke-width: 7px;

            /* Rounds the line endings to create a seamless circle 
            stroke-linecap: round; */

            /* Makes sure the animation starts at the top of the circle */
            transform: rotate(90deg);
            transform-origin: center;

            /* One second aligns with the speed of the countdown timer */
            transition: 1s linear all;

            /* Allows the ring to change color when the color value updates */
            stroke: currentColor;
        }

        .base-timer__svg {
            /* Flips the svg and makes the animation to move left-to-right */
            transform: scaleX(-1);
        }

    </style>

    

    <script type="text/babel">

class Main extends React.Component {
    constructor(props) {
        super(props);
        this.state = {
            page: "landing",
            createModal: false,
            joinModal: false,
            roomKey: "",
        };
        var that = this;

        //initialize socket event listeners

        socket.on('client-id-notification', id => {
            playerId = id;
        });

        socket.on('create-room-success', key => {
            this.setState({
                page: "pregame",
                createModal: false,
                joinModal: false,
                roomKey: key,
            });
        });

        socket.on('join-room-success', (key, name) => {
            this.setState({
                page : "pregame",
                createModal: false,
                joinModal: false,
                roomKey : key,
            });
        });
        
        socket.on('join-room-fail', function() {
            alert("Invalid room code");
        });

        socket.on('start-game-server', function () {

            //check if game can be started
            that.setState({
                page: "game",
                createModal: false,
                joinModal: false,
                roomKey: that.state.roomKey
            });
        });


    }

    

    /* View for the very first page prompting the user to enter their 
    name, and either join or create a room. If the user leaves their room,
    this page is displayed */

    displayLandingPage() {
        const createModalClass = this.state.createModal ? "" : "d-none ";
        const joinModalClass = this.state.joinModal ? "" : "d-none ";
        return (
            <div className="full-page-size">
                <div className={createModalClass + "room-modal rounded"}>
                    <div className="room-modal-content">
                        <h2 className="room-modal-title">Create a room</h2>
                        <div className="room-modal-data-box d-flex align-items-center justify-content-center">
                            <label htmlFor="room-modal-create-name" className="room-modal-label">Nickname:</label>
                            <input className="room-modal-input" id="room-modal-create-name" />
                        </div>
                        <button className="action-button modal-button rounded" onClick={() => this.createRoom()}>Create room</button>
                    </div>
                </div>
                <div 
                    className={createModalClass + "room-modal-shadow"}
                    onClick={() => this.closeEitherModal()}
                    >
                </div>
                <div className={joinModalClass + " room-modal rounded"}>
                    <div className="room-modal-content">
                        <h2 className="room-modal-title">Join a room</h2>
                        <div className="room-modal-data-box d-flex align-items-center justify-content-center">
                            <label htmlFor="room-modal-join-name" className="room-modal-label">Nickname:</label>
                            <input className="room-modal-input" id="room-modal-join-name" />
                        </div>
                        <div className="room-modal-data-box d-flex align-items-center justify-content-center">
                            <label htmlFor="room-modal-join-code" className="room-modal-label">Room code:</label>
                            <input className="room-modal-input" id="room-modal-join-code" />
                        </div>
                        <button className="action-button modal-button rounded" onClick={() => this.joinRoom()}>Join room</button>
                    </div>
                </div>
                <div 
                    className={joinModalClass + "room-modal-shadow"}
                    onClick={() => this.closeEitherModal()}
                    >
                </div>
                <div className="container">
                    <div className="title">
                        25 Words
                    </div>
                    <div className="subtitle">
                        or less!
                    </div>
                    <div className="d-flex flex-wrap justify-content-around align-items-center">
                        <div className="join-button-container align-self-start">
                            <button
                                className="action-button landing-button rounded"
                                onClick={() => this.openCreateModal()}
                                >
                                    Create a room
                            </button>
                        </div>
                        <div>
                            <div className="join-button-container">
                                <button
                                    className="action-button landing-button rounded"
                                    onClick={() => this.openJoinModal()}>
                                        Join a room
                                            
                                </button>
                            </div>
                        </div>
                    </div>
                    <h2 className="dev-log-title text-center">Update and patch history</h2>
                    <br />
                    <div className="dev-log-container rounded">

                        <div className="dev-log">
                            <div className="dev-log-element">
                                <div className="d-flex justify-content-between">
                                    <h3>Version 0.5.1</h3>
                                    <h3>08/31/20</h3>
                                </div>
                                <h5>Title page changes</h5>
                                <ul>
                                    <li>Clicking Create a room or Join a room will open a modal overlay instead of relying on the join code box and a window prompt</li>
                                </ul>
                            </div>
                            <div className="dev-log-element">
                                <div className="d-flex justify-content-between">
                                    <h3>Version 0.5.0</h3>
                                    <h3>08/31/20</h3>
                                </div>
                                <h5>Preliminary, workable version of a finished game</h5>
                                <ul>
                                    <li>Title page</li>
                                    <li>Creating, joining, and leaving server rooms</li>
                                    <li>Arranging team members</li>
                                    <li>Bidding for words</li>
                                    <li>Giving clues and sending guesses</li>
                                    <li>Sent guesses are validated by server</li>
                                    <li>Displaying words to players at appropriate times</li>
                                    <li>Game updates are shown to all players</li>
                                    <li>Server manages a time limit on different game stages</li>
                                    <li>Intermediary phases between / before bidding and guessing</li>
                                    <li>Dev log</li>
                                </ul>
                            </div>
                            <div className="dev-log-element">
                                <div className="d-flex justify-content-between">
                                    <h3>Version 0.0.0</h3>
                                    <h3>08/24/20</h3>
                                </div>
                                <h5>Development started</h5>
                                <ul>
                                    <li>Playing around with a few features</li>
                                </ul>
                            </div>
                            
                            
                        </div>
                    </div>
                </div>
                
            </div>
            
            
        );
    }

    openCreateModal() {
        this.setState({
            page: "landing",
            createModal: true,
            joinModal: false,
            roomKey: "",
        });
    }

    openJoinModal() {
        this.setState({
            page: "landing",
            createModal: false,
            joinModal: true,
            roomKey: "",
        });
    }

    closeEitherModal() {
        this.setState({
            page: "landing",
            createModal: false,
            joinModal: false,
            roomKey: "",
        });
    }

    /* Attempt to join a game room with the value of the input element 
    with id room-code. It can either fail (nothing happens) or succeed,
    setting the state's page to pregame */

    joinRoom() {
        var key = document.getElementById('room-modal-join-code').value;
        var name = document.getElementById('room-modal-join-name').value;
        if (name == "") {
            name = "I failed to type in a name";
        }
        userName = name;
        socket.emit('join-room', key, name);
    }

    /* Create a new game room and join it. This can either fail
        (max room cap reached) or succeed. Upon success the room is 
        automatically joined and the state is changed. */

    createRoom() {
        var name = document.getElementById('room-modal-create-name').value; //prompt("Your nickname");
        if (name == "") {
            name = "I failed to type in a name";
        }
        userName = name;
        socket.emit('create-room', name);
    }

    /* Display the pre game phase. Must be in a room to view.
    Allows for:
    Team Assignment
    Team Name Change
    Name Change
    Lock in / start game
    */

    displayPregamePage() {
        return (
            <div>
                <div className="info-panel">
                    <div className="container d-flex justify-content-between align-items-center">
                        <InfoPanelTexts 
                            roomKey={this.state.roomKey}
                            playerCount={playerCount} 
                        />
                        <button
                        className="action-button leave-button rounded"
                        onClick={() => this.leaveRoom()}>
                            Leave
                        </button>
                    </div>
                </div>
                <div className="container">
                    <div className="teams-container d-flex flex-wrap justify-content-center">
                        <div className="team">
                            <div className="team-header d-flex justify-content-center align-items-center">
                                <div className="team-name d-inline-block">
                                    Team 1
                                </div>
                                <JoinTeamButton
                                    roomKey = {this.state.roomKey}
                                    name = {userName}
                                    teamNumber = "1"
                                />
                            </div>
                            <TeamMembers
                                teamNumber = "1"
                            />
                        </div>
                        <div className="team">
                            <div className="team-header d-flex justify-content-center align-items-center">
                                <div className="team-name d-inline-block">
                                    Team 2
                                </div>
                                <JoinTeamButton
                                    roomKey = {this.state.roomKey}
                                    name = {userName}
                                    teamNumber = "2"
                                />
                            </div>
                            <TeamMembers
                                teamNumber = "2"
                            />
                        </div>
                    </div>
                    <div className="start-game-button-container">
                        <StartGameButton 
                        onClick={() => this.startGame()}
                        />
                    </div>
                </div>
            </div>
        );
    }

    startGame() {
        console.log("Game started");
        socket.emit('start-game', this.state.roomKey);
    }

    /* Remove the user from the current room and disconnect them
    from the server socket */

    leaveRoom() {
        socket.emit('leave-room', this.state.roomKey);
        this.setState({
            page: "landing",
            roomKey: "",
        });
    }

    /* Display the game page. Oh boy... 

    5 word slots in the middle
    Clue givers can see it, players can not (they will fill in as they are guessed)
    Middle top: Starting bid / current bid, right underneath is player name 
    that claimed it



    */

    displayGamePage() {
        return(
            <div>
                <div className="container-fluid">
                    <div className="words-panel rounded">
                        <Word index="0" />
                        <hr/>
                        <Word index="1" />
                        <hr />
                        <Word index="2" />
                        <hr />
                        <Word index="3" />
                        <hr />
                        <Word index="4" />
                    </div>
                    <GameInputPanel 
                    roomKey={this.state.roomKey}
                    />
                    <GameInfoPanel />

                </div>
            </div>
        );
    }

    /* Display the appropriate page as specified in the state 
    variable */

    render() {
        if (this.state.page == "landing") {
            return this.displayLandingPage();
            
        }
        else if (this.state.page == "pregame") {
            return this.displayPregamePage();

        }
        else if (this.state.page == "game") {
            return this.displayGamePage();
        }
        else {
            alert("uhhhh... this shouldn't happen. game's state did not match any of the valid options. report this and refresh the page");
            return (
                <div>
                    :(
                        
                </div>
            );
        }
    }
}

class RoomModal extends React.Component {
    constructor(props) {
        super(props);
        this.state = {
            hidden: true,
            mode: "create"
        };
    }

    render() {
        return(
            <div className="modal">
            </div>
        );
    }
}

class GameInputPanel extends React.Component {
    constructor(props) {
        super(props);
        this.state = {
            currentBid: 25,
            mode: "pre-bid", //none, bid, or guess
        };
        var that = this;

        socket.on('game-update', data => {
            if (data["mode"] == "pre-bid") {
                //show bidding stuff
                that.setState({
                    mode: "pre-bid"
                });
            }
            else if (data["mode"] == "bid") {
                //show bidding stuff
                that.setState({
                    currentBid: data["currentBid"],
                    mode: "bid"
                });
                //console.log("game update just came. current bid is ", that.state.currentBid);
            }
            else if (data["mode"] == "bid-sidelines") {
                //show bidding stuff
                that.setState({
                    currentBid: data["currentBid"],
                    mode: "bid-sidelines"
                });
            }
            else if (data["mode"] == "pre-guess-guesser") {
                //show bidding stuff
                that.setState({
                    currentBid: data["currentBid"],
                    mode: "pre-guess-guesser"
                });
            }
            else if (data["mode"] == "pre-guess-giver") {
                //show bidding stuff
                that.setState({
                    currentBid: data["currentBid"],
                    mode: "pre-guess-giver"
                });
            }
            else if (data["mode"] == "pre-guess-sidelines") {
                //show bidding stuff
                that.setState({
                    currentBid: data["currentBid"],
                    mode: "pre-guess-sidelines"
                });
            }
            else if (data["mode"] == "guess-giver") {
                //show guessing stuff
                that.setState({
                    currentBid: data["currentBid"],
                    mode: "guess-giver"
                });
            }
            else if (data["mode"] == "guess-receiver") {
                //show guessing stuff
                that.setState({
                    currentBid: data["currentBid"],
                    mode: "guess-receiver"
                });
            }
            else if (data["mode"] == "guess-sidelines") {
                //show guessing stuff
                that.setState({
                    currentBid: data["currentBid"],
                    mode: "guess-sidelines"
                });
            }
        });
    }

    decreasePlayerBid() {
        var bid = document.getElementById("player-bid-text-number");
        if (bid.innerHTML == "1") {
            // do nothing
        }
        else {
            const oldBid = this.state.currentBid - 1;
            this.setState({
                currentBid: oldBid,
                mode: "bid"
            });
            bid.innerHTML = this.state.currentBid;
        }
    }

    increasePlayerBid() {
        var bid = document.getElementById("player-bid-text-number");
        if (bid.innerHTML == "25") {
            // do nothing
        }
        else {
            const oldBid = this.state.currentBid + 1;
            this.setState({
                currentBid: oldBid,
                mode: "bid"
            });
            bid.innerHTML = this.state.currentBid;
        }
    }

    sendPlayerBid() {
        console.log("sending player bid which is ", this.state.currentBid);
        socket.emit('player-bid', this.props.roomKey, this.state.currentBid);
    }

    giveClue() {
        socket.emit('give-clue', this.props.roomKey, document.getElementById('word-input').value);
    }

    giveGuess() {
        socket.emit('give-guess', this.props.roomKey, document.getElementById('word-input').value);
    }

    render() {
        var that = this;
        if (this.state.mode == "pre-bid") {
            return (
                <div className="game-input-panel">
                    Bidding will start soon. If you are the cluegiver (you can see the words), prepare to bid.
                </div>
            );
        }
        else if (this.state.mode == "bid-sidelines") {
            return (
                <div className="game-input-panel">
                    Cluegivers are currently bidding.
                </div>
            );
        }
        else if (this.state.mode == "bid") {
            return (
                <div className="game-input-panel d-flex align-items-center justify-content-center">
                    <div className="submit-bid-input-container">
                        <div className="d-flex align-items-center">
                            <div className="player-bid-text">
                                Modify your bid:&nbsp;
                                <span id="player-bid-text-number" className="player-bid-text-number">
                                    {this.state.currentBid}
                                </span>
                            </div>
                            <div>
                                <div 
                                className="arrow-down"
                                onClick={function() {that.decreasePlayerBid()}}></div>
                                
                            </div>
                            <div>
                                <div 
                                className="arrow-up"
                                onClick={function() {that.increasePlayerBid()}}></div>
                            </div>
                        </div>
                    </div>
                    <div className="submit-bid-button-container">
                        <button 
                        className="submit-bid-button action-button"
                        onClick={function() {that.sendPlayerBid()}}
                        >
                            Bid
                        </button>
                    </div>
                </div>
            );
        }
        else if (this.state.mode == "pre-guess-guesser") {
            return (
                <div className="game-input-panel">
                    Get ready! Your cluegiver will start giving clues in a moment.
                </div>
            );
        }
        else if (this.state.mode == "pre-guess-giver") {
            return (
                <div className="game-input-panel">
                    Get ready! You can start giving clues in a moment.
                </div>
            );
        }
        else if (this.state.mode == "pre-guess-sidelines") {
            return (
                <div className="game-input-panel">
                    The other team is about to start the guessing phase.
                </div>
            );
        }
        else if (this.state.mode == "guess-giver") {
            return (
                <div className="game-input-panel d-flex align-items-center justify-content-center">
                    <div className="submit-guess-input-container">
                        <input className="submit-guess-input" id="word-input" />
                    </div>
                    <div className="submit-guess-button-container">
                        <button 
                        className="submit-guess-button action-button"
                        onClick={function() {that.giveClue()}}
                        >
                            Give clue
                        </button>
                    </div>
                </div>
            );
        }
        else if (this.state.mode == "guess-receiver") {
            return (
                <div className="game-input-panel d-flex align-items-center justify-content-center">
                    <div className="submit-guess-input-container">
                        <input className="submit-guess-input" id="word-input" />
                    </div>
                    <div className="submit-guess-button-container">
                        <button 
                        className="submit-guess-button action-button"
                        onClick={function() {that.giveGuess()}}
                        >
                            Guess word
                        </button>
                    </div>
                </div>
            );
        }
        else if (this.state.mode == "guess-sidelines") {
            return (
                <div className="game-input-panel">
                    The other team is trying to guess their words. If they fail, you win!
                </div>
            );
        }
    }
}

class GameInfoPanel extends React.Component {
    constructor(props) {
        super(props);
        this.state = {
            
        };

        
        
    }

    render() {
        return (
            <div className="game-info-panel d-flex align-items-center justify-content-between">
                <GameUpdates />
                {/*<GameClock />*/}
            </div>
        );
    }
}

class GameUpdates extends React.Component {
    constructor(props) {
        super(props);
        this.state = {
            elements: []
        };
        var that = this;

        socket.on('game-update', data => {
            //Read the update key to see what happened
            var newUpdate = {};
            newUpdate["playerName"] = data["update"]["playerName"];
            newUpdate["action"] = data["update"]["action"];
            newUpdate["value"] = data["update"]["value"];
            var updatedElements = that.state.elements;
            updatedElements.push(newUpdate);
            that.setState({
                elements: updatedElements
            })
        });
    }

    render() {
        const elementsReversed = this.state.elements.slice().reverse();
        return (
            <div>
                {elementsReversed.map((element, index, arr) => {
                    return (
                    <div 
                    className="game-update"
                    key={arr.indexOf(element)}
                    >
                        {arr[index]["playerName"]}
                        &nbsp;
                        <span>{arr[index]["action"]}</span>
                        &nbsp;
                        {arr[index]["value"]}
                    </div> );
                })}
            </div>
        );
    }
}

//State updates are for server events
//Client ticks down by itself based off a function called one time in the render
//which has a set time out method

class GameClock extends React.Component {
    constructor(props) {
        super(props);
        this.state = {
            timeInitial: 15,
            color: "green",
            circleDashArray: 283,
        };
        this.timer = null;

        socket.on('reset-clock', time => {
            console.log('got reset clock');
            this.setState({
                timeInitial: time,
                color: "green",
                circleDashArray: 283,
            });
            this.startTimer();
        }); 
        
        
    }

    generateClassName() {
        return "base-timer__path-remaining";
    }

    startTimer() {
        // The amount of time passed increments by one
        if (this.timer != null) {
            clearInterval(this.timer);
        }
        this.timer = setInterval(() => {
            console.log('first interval');
    
            // The amount of time passed increments by one
            this.timePassed = this.timePassed += 1;
            this.timeLeft = this.state.timeInitial - this.timePassed;
            
            // The time left label is updated
            
            if (this.timeLeft == 0) {
                clearInterval(this.timer);
            }
            document.getElementById("base-timer-label").innerHTML = this.timeLeft;

            this.setCircleDasharray();
            console.log("just updated circle dash");
        }, 1000);
    }

    calculateTimeFraction() {
        console.log(this.timeLeft, this.state.timeInitial);
        const rawTimeFraction = this.timeLeft / (this.state.timeInitial);
        console.log(rawTimeFraction, "is the fraction of dash array returned");
        return rawTimeFraction - (1 / (this.state.timeInitial + 1)) * (1 - rawTimeFraction);
    }

    // Update the dasharray value as time passes, starting with 283
    setCircleDasharray() {
    const circleDasharray = `${(
        this.calculateTimeFraction() * 283
    ).toFixed(0)} 283`;
    document
        .getElementById("base-timer-path-remaining")
        .setAttribute("stroke-dasharray", circleDasharray);
    }
    
    componentDidMount() {
        console.log('in CDM');
        this.timePassed = 0;
        this.timeLeft = this.state.timeInitial;
        // The amount of time passed increments by one
        this.timePassed = this.timePassed += 1;
        this.timeLeft = this.state.timeInitial - this.timePassed;
        // The time left label is updated
        
        if (this.timeLeft == 0) {
            //clearInterval(timerInterval);
        }
        document.getElementById("base-timer-label").innerHTML = this.timeLeft;

        this.setCircleDasharray();
        console.log("just updated circle dash");
        console.log("Calling component did mount");

        this.startTimer();
        
    }

    render() {
        console.log("in render");
        return (
            <div className="base-timer">
                <svg className="base-timer__svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <g className="base-timer__circle">
                        <circle className="base-timer__path-elapsed" cx="50" cy="50" r="45" />
                        <path
                            id="base-timer-path-remaining"
                            strokeDasharray="283"
                            className={this.generateClassName()}
                            d="
                            M 50, 50
                            m -45, 0
                            a 45,45 0 1,0 90,0
                            a 45,45 0 1,0 -90,0
                            "
                        >
                    </path>
                    </g>
                </svg>
                <span id="base-timer-label" className="base-timer__label">
                    {this.state.timeInitial}
                </span>
            </div>
        );
    }
}

class Word extends React.Component {
    constructor(props) {
        super(props);
        this.state = {
            hidden: true,
            value: "???",
            guessed: false
        }
        var that = this;

        socket.on('words', words => {
            console.log(that.props.index);
            console.log(words);
            this.setState({
                hidden: false,
                value: words[that.props.index],
                guessed: false
            });
        });

        socket.on('word-guessed', (word, index) => {
            if (index == that.props.index) {
                this.setState({
                    hidden: false,
                    value: word,
                    guessed: true
                });
                //console.log("word guessed!", word, "at index", index);
            }
            
        });
    }

    render() {
        if (this.state.hidden) {
            return (
                <div className="words-panel-word hidden-word d-flex align-items-center justify-content-center">
                    {this.state.value}
                </div>
            );
            
        }
        else {
            if (this.state.guessed) {
                return (
                    <div className="words-panel-word guessed-word d-flex align-items-center justify-content-center">
                        {this.state.value}
                    </div>
                );
            }
            else {
                return (
                    <div className="words-panel-word d-flex align-items-center justify-content-center">
                        {this.state.value}
                    </div>
                );
            }
            
        }
        
    }
}

class InfoPanelTexts extends React.Component {
    constructor(props) {
        super(props);
        this.state = {
            playerCount: props.playerCount,
        };

        socket.on('room-data', data => {
            this.setState({
                playerCount: data["playerCount"]
            });
        }); 
    }

    componentWillUnmount() {
        socket.off('room-data');
    }

    render() {
        return (
            <div className="d-flex">
                <div className="info-panel-text">
                    Room: {this.props.roomKey}
                </div>
                <div className="info-panel-text">
                    Players: {this.state.playerCount} / 8
                </div>
            </div>
        );
    }
}

class JoinTeamButton extends React.Component {
    constructor(props) {
        super(props);
        this.state = {
            enabled: true
        }

        socket.on('room-data', data => {
            var disable = false;
            // figure out which team they're on
            var members = data["team".concat(this.props.teamNumber)];
            for (var i = 0; i < members.length; i++) {
                if (Object.keys(members[i])[0] == playerId) {
                    disable = true;
                }
            }

            //Also disable when its team has 4 members

            if (members.length == 4) {
                disable = true;
            }

            //Always reset state so disabled can become enabled
            if (disable) {
                this.setState({
                    enabled: false
                });
            }
            else {
                this.setState({
                    enabled: true
                });
            }
        }); 
    }

    joinTeam(key, name, teamNumber) {
        socket.emit('join-team', key, name, teamNumber);
    }

    render() {
        var thisButton = this;
        if (this.state.enabled) {
            return (
                <div className="d-inline-block">
                    <button
                    disabled={!this.state.enabled}
                    onClick={function() { thisButton.joinTeam(thisButton.props.roomKey, thisButton.props.name, thisButton.props.teamNumber) }}
                    className="join-team-button action-button rounded"
                    >
                        Join
                    </button>
                </div>
            );
        }
        else {
            return (
                <div className="d-inline-block">
                    <button
                    disabled={!this.state.enabled}
                    className="join-team-button action-button rounded"
                    >
                        Join
                    </button>
                </div>
            );
        }
    }
}

class TeamMembers extends React.Component {
    constructor(props) {
        super(props);
        this.state = {
            clueGiverIndex: 0,
            members: []
        };

        socket.on('room-data', data => {
            this.setState({
                clueGiverIndex: data["team".concat(this.props.teamNumber).concat("ClueGiverIndex")],
                members: data["team".concat(this.props.teamNumber)]
            });
        }); 
    }

    render() {
        var that = this;
        return (
            <div>
                {this.state.members.map((member, index, arr) => {
                    return (
                    <div 
                    className={index == that.state.clueGiverIndex ? "team-member clue-giver" : "team-member"}
                    key={Object.keys(member)[0]}
                    >
                        {index + 1}: &nbsp;
                        <span>{Object.values(member)[0]}</span>
                    </div> );
                })}
            </div>
        );
    }
}

class StartGameButton extends React.Component {
    constructor(props) {
        super(props);
        this.state = {
            enabled: false
        };
        socket.on('room-data', data => {
            //Both teams need 2 or more players
            //Double check max players isn't violated
            /* TODO
            if (data["team1"].length < 2) {
                this.setState({
                    enabled: true //false
                });
                
            } */

            /*

            else if (data["team1"].length > 4) {
                this.setState({
                    enabled: false
                });
                
            } */

            /*
            else if (data["team2"].length < 2) {
                this.setState({
                    enabled: false
                });
                
            } */

            /*
            else if (data["team2"].length < 2) {
                this.setState({
                    enabled: false
                });
                
            } */

            /*
            
            else {
                this.setState({
                    enabled: true
                });
            } */
            
            //TODO delete
            this.setState({
                enabled: true
            });
        });
    }

    render() {
        var that = this;
        return (
            <button
            className="action-button"
            disabled={!this.state.enabled}
            onClick={that.props.onClick}
            >
                Start Game
            </button>
        );
    }
}

//initialize player variables

var userName = "Anonymous";
var team1 = [];
var team2 = [];
var playerCount = null;
var playerId = null;

//Initialize web socket upon page visit
let socket = io();
socket.emit('connect'); 

//Attach the react render to the DOM
ReactDOM.render(
    <Main />,
    document.getElementById('wide')
);
/*
//Event listener for user's name changes

var nameInput = document.getElementById('nick-name');
nameInput.addEventListener('input', updateName);

function updateName(e) {
    userName = e.target.value;
} */
    </script>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="theme-color" content="#222222"/>
    <meta http-equiv="Cache-control" content="public,max-age=86400">

    <title>25 Words Or Less</title>

    <meta name="description" content="25 Words Or Less game as seen on TV">
    <meta name="author" content="Austin Stout">

    <!-- SET SITE LOGO -->
    <link rel="icon" href="">
    <link rel="apple-touch-icon" href="">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">

    <!-- Jquery, React, and JSX -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script crossorigin src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>

    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>



  </head>
  <body>
    <div class="wide" id="wide">
    </div>
  </body>
</html>